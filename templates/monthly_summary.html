{% extends "base.html" %}
{% block title %}Monthly Summary{% endblock %}

{% block content %}
  <h2 class="mb-4">ðŸ“… Monthly Trip Summary</h2>

  {% set outer_index = 0 %}
  {% for device, months in trips_by_month.items() %}
    <div class="mb-5">
      <h4 class="text-primary">ðŸš› {{ device }}</h4>

      {% for month, trips in months.items() %}
        {% set outer_index = outer_index + 1 %}
        <div class="card mb-3 shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center bg-secondary text-white">
            <strong>{{ month }}</strong> â€” {{ trips | length }} trip(s)
            <button class="btn btn-light btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#month{{ outer_index }}">
              View Details
            </button>
          </div>

          <div id="month{{ outer_index }}" class="collapse">
            <div class="card-body">
              <table class="table table-bordered table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Start</th>
                    <th>End</th>
                    <th>Distance (km)</th>
                    <th>Trip Start</th>
                    <th>Trip End</th>
                  </tr>
                </thead>
                <tbody>
                  {% for trip in trips %}
                    <tr>
                      <td>{{ trip.start_location }}</td>
                      <td>{{ trip.end_location }}</td>
                      <td>{{ '%.1f'|format(trip.route_length_km or 0) }}</td>
                      <td>{{ trip.trip_start.strftime('%d/%m/%Y %H:%M') if trip.trip_start else '-' }}</td>
                      <td>{{ trip.trip_end.strftime('%d/%m/%Y %H:%M') if trip.trip_end else '-' }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endfor %}

{% endblock %}
