{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4 text-center fw-bold">🗓️ Daily Commentary - {{ today }}</h2>

    {% if grouped_trips %}
        <div class="accordion" id="commentaryAccordion">
            {% for truck, data in grouped_trips.items() %}
                <div class="accordion-item mb-3 shadow-sm">
                    <h2 class="accordion-header" id="heading{{ loop.index }}">
                        <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}">
                            🚚 Truck {{ data.truck_number }} — 👨‍✈️ Driver: {{ data.driver }}
                        </button>
                    </h2>
                    <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" data-bs-parent="#commentaryAccordion">
                        <div class="accordion-body">
                            <p><strong>Trips today:</strong> {{ data.trip_count }}</p>
                            <p><strong>Total distance:</strong> {{ data.total_distance }} km</p>
                            <p><strong>Estimated fuel used:</strong> {{ data.total_fuel }} liters</p>

                            <hr>

                            {% if data.trips %}
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>#</th>
                                                <th>Start Location</th>
                                                <th>End Location</th>
                                                <th>Distance (km)</th>
                                                <th>Fuel Estimate (L)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for trip in data.trips %}
                                                <tr>
                                                    <td>{{ loop.index }}</td>
                                                    <td>{{ trip.start_location }}</td>
                                                    <td>{{ trip.end_location }}</td>
                                                    <td>{{ trip.route_length_km }}</td>
                                                    <td>{{ trip.estimated_fuel }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <p>No trip details available.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-warning text-center">
            😕 No trip data available for today.
        </div>
    {% endif %}
</div>
{% endblock %}
