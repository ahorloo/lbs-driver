{% extends "base.html" %}
{% block title %}Weekly Summary{% endblock %}

{% block content %}
  <h2 class="mb-4">ğŸ—“ï¸ Weekly Trip Summary</h2>

  {% for device, weeks in trips_by_week.items() %}
    <div class="mb-5">
      <h4 class="text-primary">ğŸš› {{ device }}</h4>

      {% for week, trips in weeks.items() %}
        <div class="card mb-3 shadow-sm">
          <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <strong>{{ week }}</strong> â€” {{ trips | length }} trip(s)
            <button class="btn btn-outline-light btn-sm"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapse_{{ device|replace(' ', '') }}_{{ week|replace(' ', '') }}">
              ğŸ‘ View
            </button>
          </div>
          <div class="collapse" id="collapse_{{ device|replace(' ', '') }}_{{ week|replace(' ', '') }}">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-sm table-bordered table-striped">
                  <thead class="table-light">
                    <tr>
                      <th>Start</th>
                      <th>End</th>
                      <th>Distance (km)</th>
                      <th>Trip Start</th>
                      <th>Trip End</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for trip in trips %}
                      <tr>
                        <td>{{ trip.start_location }}</td>
                        <td>{{ trip.end_location }}</td>
                        <td>{{ '%.1f'|format(trip.route_length_km or 0) }}</td>
                        <td>{{ trip.trip_start.strftime('%d/%m/%Y %H:%M') if trip.trip_start else '-' }}</td>
                        <td>{{ trip.trip_end.strftime('%d/%m/%Y %H:%M') if trip.trip_end else '-' }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endfor %}
{% endblock %}
